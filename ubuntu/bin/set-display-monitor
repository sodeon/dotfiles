#!/bin/bash

# Description: If external display is connected, use external display only. If not, use internal display only
# NOTE: Intel driver won't output full RGB on external monitor: https://wiki.archlinux.org/index.php/Intel_graphics#Weathered_colors_(color_range_problems)
# Caution: external-displayrc and internal-displayrc both define same set of variables

# Read configuration
source ~/.config/hardware/displayrc
if [ -f ~/.config/hardware/external-displayrc ]; then
	source ~/.config/hardware/external-displayrc
else
    # If no multi-monitor setup, no need to change xrandr configuration
    exit 1
fi

# Assemble xrandr command
cmd="xrandr --output $interface --mode $resolution --scale $scale"
if xrandr | grep "\<$interface\> connected"; then
	if [ -f ~/.config/hardware/internal-displayrc ]; then
		source ~/.config/hardware/internal-displayrc
        if [ -z $interface ]; then
			cmd="$cmd --output $interface --off"
        fi
	fi
	if [ $isIntelGpu = true ]; then
		cmd="$cmd --set \"Broadcast RGB\" \"Full\""
    fi
fi

# Execute xrandr command
eval $cmd

